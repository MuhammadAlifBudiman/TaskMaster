{% extends 'taskmaster/layout.html' %}


{% block content %}
<div class="container">
  <div class="row justify-content-center mt-5">
    <div class="col-md-6 text-center">
      <h2>Welcome, {{ user.username }}</h2>
      {% if completed_daily_tasks == total_daily_tasks and  total_daily_tasks != 0 %}
      <h5 class="text-success">You Have Completed All Daily Task</h5>
      {% elif completed_daily_tasks != total_daily_tasks and  total_daily_tasks != 0  %}
      <h5> You have {{ completed_daily_tasks }}/{{ total_daily_tasks }} daily tasks to complete</h5>
      {% else %}
      <h5>Add New Daily Task</h5>
      {% endif %}
      {% if completed_weekly_tasks == total_weekly_tasks and total_weekly_tasks != 0 %}
      <h5 class="text-success">You Have Completed All Weekly Task</h5>
      {% elif completed_weekly_tasks != total_weekly_tasks and total_weekly_tasks != 0 %}
      <h5> You have {{ completed_weekly_tasks }}/{{ total_weekly_tasks }} weekly tasks to complete</h5>
      {% else %}
      <h5>Add New Weekly Task</h5>
      {% endif %}
      {% if completed_all_tasks %}
      <h1 class="text-success">Good Job <i class="uil uil-thumbs-up"></i></h1>
      {% endif %}
      <div class="mt-5">
        <a href="{% url 'dailytask' %}" class="btn btn-primary btn-lg me-3">Daily Task</a>
        <a href="{% url 'weeklytask' %}" class="btn btn-primary btn-lg">Weekly Task</a>
      </div>
      <div class="mt-3">
        <a href="{% url 'logout' %}" class="btn btn-sm btn-danger logout">Logout</a>
      </div>
    </div>
  </div>
</div>

<script>
  var userTimeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;

  fetch('set-timezone/', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'X-CSRFToken':   '{{ csrf_token }}'
    },
    body: JSON.stringify({ timeZone: userTimeZone }),
  })
    .then(response => {
      if (response.ok) {
        // The request was successful (status code 200-299)
        return response.json(); // Parse the response as JSON
      } else {
        throw new Error('Request failed with status code ' + response.status);
      }
    })
    .catch(error => {
      // Handle any errors that occur during the request
      console.error('Request error:', error);
    });
</script>
{% endblock %}